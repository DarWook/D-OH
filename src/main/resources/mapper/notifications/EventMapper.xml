<mapper namespace="com.DOH.DOH.mapper.notifications.EventMapper">

    <!-- 이벤트 작성 (insert) -->
    <insert id="insertEvent">
        <selectKey keyProperty="eventNum" resultType="long" order="BEFORE">
            SELECT IFNULL(MAX(eventNum), 0) + 1 FROM event
        </selectKey>
        INSERT INTO event (
        eventNum, eventTitle, eventContent, eventCreateTime, userNum, eventTempSave
        ) VALUES (
        #{eventNum}, #{eventTitle}, #{eventContent}, NOW(), #{userNum}, #{eventTempSave}
        )
    </insert>

    <!-- 이벤트 번호로 이벤트 조회 -->
    <select id="selectEventById" resultType="com.DOH.DOH.dto.notifications.EventDTO">
        SELECT
        eventNum, eventTitle, eventContent, eventCreateTime, userNum, eventTempSave
        FROM
        event
        WHERE
        eventNum = #{eventNum}
    </select>

    <!-- 이벤트 수정 -->
    <update id="updateEvent">
        UPDATE event
        SET
        eventTitle = #{eventTitle},
        eventContent = #{eventContent},
        eventTempSave = #{eventTempSave}
        WHERE
        eventNum = #{eventNum}
    </update>

    <!-- 임시 저장된 이벤트 수정 -->
    <update id="updateTempEvent">
        UPDATE event
        SET
        eventTitle = #{eventTitle},
        eventContent = #{eventContent},
        eventCreateTime = NOW()  <!-- 수정 시 수정 시간을 갱신할 수 있음 -->
        WHERE
        eventNum = #{eventNum}
        AND eventTempSave = true
    </update>

    <!-- 이벤트 삭제 -->
    <delete id="deleteEvent">
        DELETE FROM event
        WHERE eventNum = #{eventNum}
    </delete>

    <!-- 정식 저장된 이벤트 목록 조회 (페이징 처리 포함) -->
    <select id="getEventList" resultType="com.DOH.DOH.dto.notifications.EventDTO">
        SELECT
        eventNum, eventTitle, eventContent, eventCreateTime, userNum, eventTempSave
        FROM
        event
        WHERE
        eventTempSave = false
        ORDER BY eventCreateTime DESC, eventNum DESC
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 임시 저장된 이벤트 목록 조회 (최대 3개) -->
    <select id="findTempEvents" resultType="com.DOH.DOH.dto.notifications.EventDTO">
        SELECT
        eventNum, eventTitle, eventContent, eventCreateTime, userNum, eventTempSave
        FROM
        event
        WHERE
        eventTempSave = true
        ORDER BY eventCreateTime DESC, eventNum DESC
        LIMIT 3
    </select>

    <!-- 전체 정식 이벤트 수 조회 -->
    <select id="getTotalEvents" resultType="int">
        SELECT COUNT(*) FROM event WHERE eventTempSave = false
    </select>

    <!-- 전체 임시 저장된 이벤트 수 조회 -->
    <select id="getTotalTempEvents" resultType="int">
        SELECT COUNT(*) FROM event WHERE eventTempSave = true
    </select>

</mapper>
